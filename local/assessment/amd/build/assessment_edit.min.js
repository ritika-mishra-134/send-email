define(["jquery","core/ajax","core/str","sweetalert2","core/url","select2-js"],function(a,b,c,d,e){var f={dom:{main:null},variable:{pattern:/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/},langs:{nameRequired:null,descrptionRequired:null,assessmentIdRequired:null,assessmentPriceRequired:null,assessmentPartneRequired:null,updateSuccessfull:null,choose:null,vendorPriceRequired:null,validUrl:null,validLogo:null},action:{getString:function(a,b){c.get_strings([{key:"namerequired",component:"local_assessment"},{key:"descrptionrequired",component:"local_assessment"},{key:"assessmentidrequired",component:"local_assessment"},{key:"assessmentpricerequired",component:"local_assessment"},{key:"assessmentpartnerequired",component:"local_assessment"},{key:"updatesuccessfull",component:"local_assessment"},{key:"choose",component:"local_assessment"},{key:"vendorpricerequired",component:"local_assessment"},{key:"validurl",component:"local_assessment"},{key:"validlogo",component:"local_assessment"}]).then(function(c){f.langs.nameRequired=c[0],f.langs.descrptionRequired=c[1],f.langs.assessmentIdRequired=c[2],f.langs.assessmentPriceRequired=c[3],f.langs.assessmentPartneRequired=c[4],f.langs.updateSuccessfull=c[5],f.langs.choose=c[6],f.langs.vendorPriceRequired=c[7],f.langs.validUrl=c[8],f.langs.validLogo=c[9],f.init(a,b)}).fail(function(){})},validation:function(){return""==f.dom.name.val().trim()?(f.dom.nameRequired.html(f.langs.nameRequired).css({color:"red"}),!1):""==f.dom.description.val().trim()?(f.dom.descriptionRequired.html(f.langs.descrptionRequired).css({color:"red"}),!1):null===f.dom.assessmentPartner.val()?(f.dom.assessmentPartneRequired.html(f.langs.assessmentPartneRequired).css({color:"red"}),!1):""==f.dom.assessmentId.val()?(f.dom.assessmentIdRequired.html(f.langs.assessmentIdRequired).css({color:"red"}),!1):1==f.dom.logo.files.length&&"image/png"!==f.dom.logo.files[0].type&&"image/jpeg"!==f.dom.logo.files[0].type?(f.dom.logoRequired.html(f.langs.validLogo).css({color:"red"}),!1):""===f.dom.link.val()||f.variable.pattern.test(f.dom.link.val().trim())?"1"==f.dom.assessmentPaid.val()&&""==f.dom.merchantPrice.val()?(f.dom.merchantPriceRequired.html(f.langs.assessmentPriceRequired).css({color:"red"}),!1):!("1"==f.dom.assessmentPaid.val()&&!f.dom.vendorPrice.prop("disabled")&&""==f.dom.vendorPrice.val())||(f.dom.vendorRequired.html(f.langs.vendorPriceRequired).css({color:"red"}),!1):(f.dom.linkRequired.html(f.langs.validUrl).css({color:"red"}),!1)},ssoValues:function(a){var c=b.call([{methodname:"local_assessment_ssovalues",args:{id:a}}]);c[0].done(function(a){null!==a.samlssoid?f.dom.sso.append('<option value="'+a.samlssoid+'">'+a.name+"</option>",'<option value="0">'+f.langs.none+"</option>"):f.dom.sso.append('<option value="0">'+f.langs.none+"</option>")}).fail(function(){})},paidStatus:function(){var a=b.call([{methodname:"local_assessment_paymentdetails",args:{id:f.dom.assessmentPartner.val()}}]);a[0].done(function(a){0==a.paid?(f.dom.assessmentPaid.prop("disabled",!0),f.dom.merchantPrice.prop("disabled",!0),f.dom.vendorPrice.prop("disabled",!0)):(f.dom.assessmentPaid.prop("disabled",!1),1==a.vendor?(f.dom.vendorPrice.prop("disabled",!1),f.dom.merchantPrice.prop("disabled",!1)):(f.dom.merchantPrice.prop("disabled",!0),f.dom.vendorPrice.prop("disabled",!0)))}).fail(function(){})},editAssessment:function(a,c){var g=b.call([{methodname:"local_assessment_assessmentedit",args:{id:a,name:f.dom.name.val(),description:f.dom.description.val().trim(),sso:0===f.dom.sso.val()?0:f.dom.sso.val(),assessmentpartner:f.dom.assessmentPartner.val(),assessmentid:f.dom.assessmentId.val(),link:f.dom.link.val(),merchantprice:f.dom.merchantPrice.val(),paymentid:c,amountpaid:f.dom.assessmentPaid.val(),vendorprice:f.dom.vendorPrice.val()}}]);g[0].done(function(a){1==a.status&&(1==f.dom.logo.files.length?f.dom.mainForm.submit():d.fire({position:"center",icon:"success",title:f.langs.updateSuccessfull,showConfirmButton:!1,timer:1500}).then(function(){window.location.href=e.relativeUrl("local/assessment/assessment_list.php")}))}).fail(function(){})}},init:function(b,c){f.dom.main=a(document).find("#assessment_form"),f.dom.mainForm=a(document).find("#assesmentcreationForm"),f.dom.nameRequired=f.dom.main.find("#nameRequired"),f.dom.descriptionRequired=f.dom.main.find("#descriptionRequired"),f.dom.assessmentPartneRequired=f.dom.main.find("#assessmentpartnerequired"),f.dom.assessmentIdRequired=f.dom.main.find("#assessmentidrequired"),f.dom.merchantPriceRequired=f.dom.main.find("#merchantpricerequired"),f.dom.vendorRequired=f.dom.main.find("#vendorpricerequired"),f.dom.linkRequired=f.dom.main.find("#linkrequired"),f.dom.logoRequired=f.dom.main.find("#logoRequired"),f.dom.name=f.dom.main.find("#name"),f.dom.description=f.dom.main.find("#assessmentdescription"),f.dom.assessmentPartner=f.dom.main.find("#assessmntparner"),f.dom.assessmentId=f.dom.main.find("#assessment_id"),f.dom.sso=f.dom.main.find("#sso"),f.dom.link=f.dom.main.find("#link"),f.dom.merchantPrice=f.dom.main.find("#merchantprice"),f.dom.assessmentPaid=f.dom.main.find("#assessmentpaid"),f.dom.logo=f.dom.mainForm.find("#assessmentlogo")[0],f.dom.vendorPrice=f.dom.main.find("#vendorprice"),f.dom.assessmentPartner.select2({placeholder:f.langs.choose,allowClear:!0}),f.dom.sso.select2({placeholder:f.langs.choose,allowClear:!0}),f.dom.assessmentPaid.select2({placeholder:f.langs.choose,allowClear:!0}),f.dom.main.on("click","#editbutton",function(a){a.preventDefault(),1==f.action.validation()&&f.action.editAssessment(b,c)}),f.dom.assessmentPaid.on("change",function(){"1"==f.dom.assessmentPaid.val()?f.dom.merchantPrice.prop("disabled",!1):(f.dom.merchantPrice.val(""),f.dom.vendorPrice.val(""),f.dom.merchantPrice.prop("disabled",!0),f.dom.vendorPrice.prop("disabled",!0))}),f.dom.assessmentPartner.on("change",function(){f.dom.sso.empty(),f.dom.assessmentPaid.val(""),f.dom.assessmentPaid.prepend(a("<option>",{value:"",text:f.langs.choose,selected:"selected"})),f.dom.merchantPrice.val(""),f.dom.vendorPrice.val(""),f.action.ssoValues(a(this).val()),f.action.paidStatus()})}};return{init:f.action.getString}});