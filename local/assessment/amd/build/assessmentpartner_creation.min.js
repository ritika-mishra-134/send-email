define(["jquery","core/ajax","core/str","select2-js"],function(a,b,c){var d={dom:{main:null},variable:{pattern:/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/},langs:{enterName:null,enterDescription:null,enterEmail:null,enterValidEmail:null,enterApiEndpoint:null,enterToken:null,enterLogo:null,choose:null,validLogo:null},action:{getString:function(){c.get_strings([{key:"namerequired",component:"local_assessment"},{key:"emailrequired",component:"local_assessment"},{key:"logorequired",component:"local_assessment"},{key:"descrptionrequired",component:"local_assessment"},{key:"validemail",component:"local_assessment"},{key:"enterapiendpoint",component:"local_assessment"},{key:"entertoken",component:"local_assessment"},{key:"choose",component:"local_assessment"},{key:"validlogo",component:"local_assessment"}]).then(function(a){d.langs.enterName=a[0],d.langs.enterEmail=a[1],d.langs.enterLogo=a[2],d.langs.enterDescription=a[3],d.langs.enterValidEmail=a[4],d.langs.enterApiEndpoint=a[5],d.langs.enterToken=a[6],d.langs.choose=a[7],d.langs.validLogo=a[8],d.init()}).fail(function(){})},validation:function(){return""==d.dom.name.val().trim()?(d.dom.nameRequired.html(d.langs.enterName).css({color:"red"}),!1):""==d.dom.description.val().trim()?(d.dom.descriptionRequired.html(d.langs.enterDescription).css({color:"red"}),!1):1!=d.dom.logo.files.length?(d.dom.logoRequired.html(d.langs.enterLogo).css({color:"red"}),!1):"image/png"!==d.dom.logo.files[0].type&&"image/jpeg"!==d.dom.logo.files[0].type?(d.dom.logoRequired.html(d.langs.validLogo).css({color:"red"}),!1):""==d.dom.email.val().trim()?(d.dom.emailRequired.html(d.langs.enterEmail).css({color:"red"}),!1):d.variable.pattern.test(d.dom.email.val().trim())?!(null!==d.dom.payment.val()&&""==d.dom.apiEndPoint.val()||null!==d.dom.payment.val()&&""==d.dom.token.val())||(""==d.dom.apiEndPoint.val()?(d.dom.apiRequired.html(d.langs.enterApiEndpoint).css({color:"red"}),!1):""!=d.dom.token.val().trim()||(d.dom.tokenRequired.html(d.langs.enterToken).css({color:"red"}),!1)):(d.dom.emailRequired.html(d.langs.enterValidEmail).css({color:"red"}),!1)},createAssessmentPartner:function(){var c=b.call([{methodname:"local_assessment_assessment_creation",args:{name:d.dom.name.val().trim(),description:d.dom.description.val().trim(),sso:null===d.dom.sso.val()?0:d.dom.sso.val(),payment:null===d.dom.payment.val()?0:d.dom.payment.val(),subpayment:null===d.dom.subPayment.val()?0:d.dom.subPayment.val(),email:d.dom.email.val(),apiendpoint:d.dom.apiEndPoint.val()||"",apitoken:d.dom.token.val()||""}}]);c[0].done(function(b){if(1==b.status)d.dom.main.submit();else{var c=a("<div class='alert alert-danger'>"+b.message+"</div>");d.dom.mainForm.prepend(c)}}).fail(function(){})}},init:function(){d.dom.mainForm=a(document).find("#assessment_form"),d.dom.main=a(document).find("#assesmentForm"),d.dom.nameRequired=d.dom.main.find("#nameRequired"),d.dom.descriptionRequired=d.dom.main.find("#descriptionRequired"),d.dom.logoRequired=d.dom.main.find("#logoRequired"),d.dom.emailRequired=d.dom.main.find("#emailRequired"),d.dom.apiRequired=d.dom.main.find("#apirequired"),d.dom.tokenRequired=d.dom.main.find("#tokenrequired"),d.dom.name=d.dom.main.find("#name"),d.dom.description=d.dom.main.find("#description"),d.dom.logo=d.dom.main.find("#logo")[0],d.dom.payment=d.dom.main.find("#payment"),d.dom.subPayment=d.dom.main.find("#subpayment"),d.dom.email=d.dom.main.find("#email"),d.dom.apiEndPoint=d.dom.main.find("#api_endponit"),d.dom.token=d.dom.main.find("#token"),d.dom.sso=d.dom.main.find("#sso"),d.dom.subPayment.prop("disabled",!0),d.dom.main.on("click","#assessment_creation",function(a){a.preventDefault(),1==d.action.validation()&&d.action.createAssessmentPartner()}),d.dom.sso.select2({placeholder:d.langs.choose,allowClear:!0}),d.dom.payment.select2({placeholder:d.langs.choose,allowClear:!0}),d.dom.subPayment.select2({placeholder:d.langs.choose,allowClear:!0}),d.dom.payment.on("change",function(){""===a(this).val()?(d.dom.subPayment.prop("disabled",!0),d.dom.apiEndPoint.prop("disabled",!0),d.dom.token.prop("disabled",!0)):(d.dom.subPayment.prop("disabled",!1),d.dom.apiEndPoint.prop("disabled",!1),d.dom.token.prop("disabled",!1))})}};return{init:d.action.getString}});