define(["jquery","core/ajax","core/str","select2-js"],function(a,b,c){var d={dom:{main:null},variable:{pattern:/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/},langs:{nameRequired:null,logoRequired:null,descrptionRequired:null,assessmentIdRequired:null,assessmentPriceRequired:null,assessmentPartneRequired:null,none:null,choose:null,vendorPriceRequired:null,validUrl:null,validLogo:null},action:{getString:function(){c.get_strings([{key:"namerequired",component:"local_assessment"},{key:"logorequired",component:"local_assessment"},{key:"descrptionrequired",component:"local_assessment"},{key:"assessmentidrequired",component:"local_assessment"},{key:"assessmentpricerequired",component:"local_assessment"},{key:"assessmentpartnerequired",component:"local_assessment"},{key:"none",component:"local_assessment"},{key:"choose",component:"local_assessment"},{key:"vendorpricerequired",component:"local_assessment"},{key:"validurl",component:"local_assessment"},{key:"validlogo",component:"local_assessment"}]).then(function(a){d.langs.nameRequired=a[0],d.langs.logoRequired=a[1],d.langs.descrptionRequired=a[2],d.langs.assessmentIdRequired=a[3],d.langs.assessmentPriceRequired=a[4],d.langs.assessmentPartneRequired=a[5],d.langs.none=a[6],d.langs.choose=a[7],d.langs.vendorPriceRequired=a[8],d.langs.validUrl=a[9],d.langs.validLogo=a[10],d.init()}).fail(function(){})},validation:function(){return""==d.dom.name.val().trim()?(d.dom.nameRequired.html(d.langs.nameRequired).css({color:"red"}),!1):""==d.dom.description.val().trim()?(d.dom.descriptionRequired.html(d.langs.descrptionRequired).css({color:"red"}),!1):null===d.dom.assessmentPartner.val()?(d.dom.assessmentPartneRequired.html(d.langs.assessmentPartneRequired).css({color:"red"}),!1):""===d.dom.link.val()||d.variable.pattern.test(d.dom.link.val().trim())?""==d.dom.assessmentId.val()?(d.dom.assessmentIdRequired.html(d.langs.assessmentIdRequired).css({color:"red"}),!1):1!=d.dom.logo.files.length?(d.dom.logoRequired.html(d.langs.logoRequired).css({color:"red"}),!1):"image/png"!==d.dom.logo.files[0].type&&"image/jpeg"!==d.dom.logo.files[0].type?(d.dom.logoRequired.html(d.langs.validLogo).css({color:"red"}),!1):"1"==d.dom.assessmentPaid.val()&&""==d.dom.merchantPrice.val()?(d.dom.merchantPriceRequired.html(d.langs.assessmentPriceRequired).css({color:"red"}),!1):!("1"==d.dom.assessmentPaid.val()&&!d.dom.vendorPrice.prop("disabled")&&""==d.dom.vendorPrice.val())||(d.dom.vendorRequired.html(d.langs.vendorPriceRequired).css({color:"red"}),!1):(d.dom.linkRequired.html(d.langs.validUrl).css({color:"red"}),!1)},createAssessment:function(){var c=b.call([{methodname:"local_assessment_createassessment",args:{name:d.dom.name.val().trim(),description:d.dom.description.val().trim(),assessmentpartner:d.dom.assessmentPartner.val(),assessmentid:null===d.dom.assessmentId.val()?0:d.dom.assessmentId.val(),sso:null===d.dom.sso.val()?0:d.dom.sso.val(),link:d.dom.link.val(),merchantprice:d.dom.merchantPrice.val(),assessmentpaid:d.dom.assessmentPaid.val(),vendorprice:d.dom.vendorPrice.val()}}]);c[0].done(function(b){if(1==b.status)d.dom.main.submit();else{var c=a("<div class='alert alert-danger'>"+b.message+"</div>");d.dom.main.prepend(c)}}).fail(function(){})},ssoValues:function(a){var c=b.call([{methodname:"local_assessment_ssovalues",args:{id:a}}]);c[0].done(function(a){0!=a.samlssoid&&null!==a.samlssoid?d.dom.sso.append('<option value="'+a.samlssoid+'">'+a.name+"</option>",'<option value="0">'+d.langs.none+"</option>"):d.dom.sso.append('<option value="0">'+d.langs.none+"</option>")}).fail(function(){})},paidStatus:function(){var a=b.call([{methodname:"local_assessment_paymentdetails",args:{id:d.dom.assessmentPartner.val()}}]);a[0].done(function(a){0==a.paid?(d.dom.assessmentPaid.prop("disabled",!0),d.dom.merchantPrice.prop("disabled",!0),d.dom.vendorPrice.prop("disabled",!0)):(d.dom.assessmentPaid.prop("disabled",!1),1==a.vendor?(d.dom.vendorPrice.prop("disabled",!1),d.dom.merchantPrice.prop("disabled",!1)):(d.dom.merchantPrice.prop("disabled",!0),d.dom.vendorPrice.prop("disabled",!0)))}).fail(function(){})},validateDecimalPlaces:function(b,c){var d=a(b).val(),e=(d.split(".")[1]||"").length;if(e>c){var f=parseFloat(d).toFixed(c);a(b).val(f)}}},init:function(){d.dom.main=a(document).find("#assesmentcreationForm"),d.dom.nameRequired=d.dom.main.find("#nameRequired"),d.dom.descriptionRequired=d.dom.main.find("#descriptionRequired"),d.dom.logoRequired=d.dom.main.find("#logoRequired"),d.dom.assessmentPartneRequired=d.dom.main.find("#assessmentpartnerequired"),d.dom.assessmentIdRequired=d.dom.main.find("#assessmentidrequired"),d.dom.merchantPriceRequired=d.dom.main.find("#merchantpricerequired"),d.dom.vendorRequired=d.dom.main.find("#vendorpricerequired"),d.dom.linkRequired=d.dom.main.find("#linkrequired"),d.dom.name=d.dom.main.find("#name"),d.dom.description=d.dom.main.find("#assessmentdescription"),d.dom.assessmentPartner=d.dom.main.find("#assessmntparner"),d.dom.assessmentId=d.dom.main.find("#assessment_id"),d.dom.sso=d.dom.main.find("#sso"),d.dom.link=d.dom.main.find("#link"),d.dom.assessmentPrice=d.dom.main.find("#assessmentprice"),d.dom.logo=d.dom.main.find("#assessmentlogo")[0],d.dom.assessmentPaid=d.dom.main.find("#assessmentpaid"),d.dom.merchantPrice=d.dom.main.find("#merchantprice"),d.dom.vendorPrice=d.dom.main.find("#vendorprice"),d.dom.assessmentPaid.prop("disabled",!0),d.dom.assessmentPartner.select2({placeholder:d.langs.choose,allowClear:!0}),d.dom.sso.select2({placeholder:d.langs.choose,allowClear:!0}),d.dom.assessmentPaid.select2({laceholder:d.langs.choose,allowClear:!0}),d.dom.main.on("click","#assessmentcreation",function(a){a.preventDefault(),1==d.action.validation()&&d.action.createAssessment()}),d.dom.assessmentPaid.on("change",function(){"1"==d.dom.assessmentPaid.val()?d.dom.merchantPrice.prop("disabled",!1):(d.dom.merchantPrice.prop("disabled",!0),d.dom.vendorPrice.prop("disabled",!0))}),d.dom.assessmentPartner.on("change",function(){d.dom.sso.empty(),d.dom.assessmentPaid.val("").trigger("change"),d.action.ssoValues(a(this).val()),d.dom.merchantPrice.val(""),d.dom.vendorPrice.val(""),d.action.paidStatus()}),d.dom.merchantPrice.on("input",function(){d.action.validateDecimalPlaces(this,2)}),d.dom.vendorPrice.on("input",function(){d.action.validateDecimalPlaces(this,2)})}};return{init:d.action.getString}});